[gd_resource type="ShaderMaterial" load_steps=5 format=2]

[ext_resource path="res://assets/textures/wattle and daub/wattle_daub_bump.jpg" type="Texture" id=1]
[ext_resource path="res://assets/textures/wattle and daub/wattle_daub_normal.jpg" type="Texture" id=2]
[ext_resource path="res://assets/textures/wattle and daub/wattle_daub_color.jpg" type="Texture" id=3]

[sub_resource type="Shader" id=1]
code = "shader_type spatial;
render_mode specular_schlick_ggx;

uniform sampler2D color_texture;
uniform sampler2D normal_map;
uniform sampler2D roughness_map;
uniform sampler2D height_map;
uniform sampler2D noise_texture;

uniform vec4 moss_color : hint_color = vec4(0.541, 0.603, 0.356, 1.0);
uniform vec4 rot_color : hint_color = vec4(0.09, 0.05, 0.0, 1.0);
uniform float depth_intensity = 1.3;
uniform float roughness = 1.0;
uniform float humidity = 0.0;
const vec3 up_vector = vec3(0.0, 1.0, 0.0);


void vertex() {
	vec4 height_vec = texture(height_map, VERTEX.xz);
	if (VERTEX.y > 0.0){ 
		VERTEX.y += height_vec.x * 0.25 * clamp(humidity * 2.0, 0.1, 1.0);
		VERTEX.y -= 1.0 * clamp(humidity, 0.0, 1.0);
	}
}

void fragment() {
	
	vec2 uv = vec2(UV.x, UV.y) * 4.0;
	vec3 noise_vec = texture(noise_texture,  uv).rgb;
	vec3 color_vec = texture(color_texture, uv).rgb;
	vec3 normal_vec = texture(normal_map, uv).rgb;
	vec3 roughness_vec = texture(roughness_map, uv).rgb;

	float cut_factor = 0.15 + humidity/2.4;
	float dynamic = 0.32;
	float noise = noise_vec.g;
	noise = smoothstep(cut_factor, cut_factor + 0.45, noise);
	
	vec3 moss = moss_color.rgb * noise_vec.r;
	color_vec = mix(color_vec, rot_color.rgb, clamp(humidity * 1.2, 0.0, 0.965));

	ALBEDO = color_vec;
	ROUGHNESS = roughness_vec.r * roughness;
	NORMALMAP = normal_vec.rgb;

}"

[resource]
shader = SubResource( 1 )
shader_param/moss_color = Color( 0.121569, 0.901961, 0.00392157, 1 )
shader_param/rot_color = Color( 0, 0, 0, 1 )
shader_param/depth_intensity = 1.0
shader_param/roughness = 1.2
shader_param/humidity = 0.0
shader_param/color_texture = ExtResource( 3 )
shader_param/normal_map = ExtResource( 2 )
shader_param/height_map = ExtResource( 1 )
