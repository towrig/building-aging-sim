[gd_resource type="ShaderMaterial" load_steps=7 format=2]

[ext_resource path="res://assets/textures/ph_reed_new_textures/reed_roof_04_rough_4k.jpg" type="Texture" id=1]
[ext_resource path="res://assets/textures/ph_reed_new_textures/reed_roof_04_diff_4k.jpg" type="Texture" id=2]
[ext_resource path="res://assets/textures/ph_reed_old_textures/riet_01_diff_4k.jpg" type="Texture" id=3]
[ext_resource path="res://assets/textures/ph_reed_new_textures/reed_roof_04_disp_4k.png" type="Texture" id=5]
[ext_resource path="res://assets/textures/ph_reed_new_textures/reed_roof_04_nor_gl_4k.png" type="Texture" id=6]

[sub_resource type="Shader" id=1]
code = "shader_type spatial;
render_mode specular_schlick_ggx;

uniform sampler2D color_texture;
uniform sampler2D old_color_texture;
uniform sampler2D normal_map;
uniform sampler2D roughness_map;
uniform sampler2D height_map;


uniform vec4 moss_color : hint_color = vec4(0.541, 0.603, 0.356, 1.0);
uniform vec4 rot_color : hint_color = vec4(0.09, 0.05, 0.0, 1.0);
uniform float roughness = 1.0;
uniform float humidity = 0.0;
const vec3 up_vector = vec3(0.0, 1.0, 0.0);


void vertex() {
  float height = texture(height_map, VERTEX.xz).x;
  if (VERTEX.y > 0.00){ 
    VERTEX.y += height * 0.05;
  }
}

void fragment() {
	
	vec2 uv = vec2(UV.x, UV.y);
	vec3 color_vec = texture(color_texture, uv).rgb;
	vec3 old_color_vec = texture(old_color_texture, uv).rgb;
	vec3 normal_vec = texture(normal_map, uv).rgb;
	vec3 roughness_vec = texture(roughness_map, uv).rgb;

	color_vec = mix(color_vec, old_color_vec, clamp(humidity*3.0, 0.0, 1.0));
	vec3 color_vec_with_rot = mix(color_vec, rot_color.rgb, clamp(humidity*3.0, 0.0, 0.9));

	ALBEDO = color_vec_with_rot;
	ROUGHNESS = roughness_vec.r * roughness;
	NORMALMAP = normal_vec.rgb;

}"

[resource]
shader = SubResource( 1 )
shader_param/moss_color = Color( 0.403922, 0.294118, 0, 1 )
shader_param/rot_color = Color( 0.227451, 0.176471, 0.0823529, 1 )
shader_param/roughness = 1.4
shader_param/humidity = 1.046
shader_param/color_texture = ExtResource( 2 )
shader_param/old_color_texture = ExtResource( 3 )
shader_param/normal_map = ExtResource( 6 )
shader_param/roughness_map = ExtResource( 1 )
shader_param/height_map = ExtResource( 5 )
