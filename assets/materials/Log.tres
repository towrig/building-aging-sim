[gd_resource type="ShaderMaterial" load_steps=6 format=2]

[ext_resource path="res://assets/textures/log-end_normal.png" type="Texture" id=1]
[ext_resource path="res://assets/textures/log-end-tex.jpg" type="Texture" id=2]
[ext_resource path="res://assets/materials/Luos_FreeGiveAway/Noise_Gradients/T_Random_39.png" type="Texture" id=3]
[ext_resource path="res://assets/materials/Luos_FreeGiveAway/Noise_Gradients/T_Random_00.png" type="Texture" id=4]

[sub_resource type="Shader" id=1]
code = "shader_type spatial;
render_mode specular_schlick_ggx;

uniform sampler2D color_texture;
uniform sampler2D normal_map;
uniform sampler2D noise_texture;
uniform sampler2D other_noise_texture;

uniform float scale = 2.0;
uniform float depth_intensity = 1.3;
uniform float roughness = 1.0;
uniform vec4 moss_color : hint_color = vec4(0.541, 0.603, 0.356, 1.0);
uniform float humidity = 0.0;

void vertex() {
// Output:0

}

void fragment() {
	vec2 uv = vec2(UV.x, UV.y);
	vec3 noise_vec = texture(noise_texture,  uv).rgb;
	vec3 other_noise_vec = texture(other_noise_texture,  uv).rgb;
	vec3 color_vec = texture(color_texture, (uv - 0.5) * 2.0).rgb;
	vec3 normal_vec = texture(normal_map, (uv - 0.5) * 2.0).rgb;

	float cut_factor = 0.15 + humidity/2.4;
	float dynamic = 0.32;
	float noise = noise_vec.g;
	noise = smoothstep(cut_factor, cut_factor + 0.45, noise);
	float other_noise = other_noise_vec.g;
	other_noise = smoothstep(cut_factor, cut_factor + dynamic, other_noise);
	
	vec3 moss = moss_color.rgb * other_noise_vec.r * noise_vec.r;
	color_vec = color_vec * (1.0 - humidity * 0.6 * noise);
	vec3 new_color_vec = mix(moss, color_vec, other_noise);
	new_color_vec = mix(color_vec, new_color_vec, clamp(humidity*5.0, 0.0, 1.0));
	
	ALBEDO = new_color_vec;
	ROUGHNESS = normal_vec.z * (roughness - humidity);
	NORMALMAP = normal_vec.xyz;
	NORMALMAP_DEPTH = normal_vec.z * depth_intensity;

}

void light() {
// Output:0

}
"

[resource]
shader = SubResource( 1 )
shader_param/scale = 2.0
shader_param/depth_intensity = 10.0
shader_param/roughness = 2.0
shader_param/moss_color = Color( 0.541, 0.603, 0.356, 1 )
shader_param/humidity = 0.0
shader_param/color_texture = ExtResource( 2 )
shader_param/normal_map = ExtResource( 1 )
shader_param/noise_texture = ExtResource( 4 )
shader_param/other_noise_texture = ExtResource( 3 )
